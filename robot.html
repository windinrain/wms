<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WMS 机器人大屏交互原型</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #1e293b;
            margin: 0;
            overflow: hidden;
        }
        
        .font-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
        .font-tech { font-family: "Arial Black", "Arial", sans-serif; letter-spacing: 0.05em; }

        .scan-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: scan 3s linear infinite;
            z-index: 10;
        }

        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            100% { top: 100%; opacity: 0; }
        }

        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .breathing-bg { animation: breathing 4s ease-in-out infinite; }
        @keyframes breathing {
            0% { background-color: rgba(16, 185, 129, 0.05); }
            50% { background-color: rgba(16, 185, 129, 0.15); }
            100% { background-color: rgba(16, 185, 129, 0.05); }
        }

        .voice-wave { display: flex; align-items: center; gap: 4px; height: 20px; }
        .voice-bar { width: 4px; background: #60a5fa; border-radius: 2px; animation: sound 0.5s ease-in-out infinite alternate; }
        @keyframes sound { 0% { height: 4px; opacity: 0.5; } 100% { height: 20px; opacity: 1; } }

        /* 上传动画 */
        .upload-dots span {
            animation: upload 1.4s infinite ease-in-out both;
        }
        .upload-dots span:nth-child(1) { animation-delay: -0.32s; }
        .upload-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes upload {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* 语音助手动画 */
        .orb {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(96, 165, 250, 0.8), rgba(37, 99, 235, 0.4));
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.6);
            animation: float 6s ease-in-out infinite;
            position: relative;
        }
        .orb::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120%;
            height: 120%;
            border-radius: 50%;
            border: 1px solid rgba(147, 197, 253, 0.3);
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes pulse-ring {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="root" class="w-full h-screen flex flex-col items-center justify-center"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 通用组件 ---

        // 统一进度条组件
        const ProgressBar = ({ progress, colorClass, label }) => (
            <div className="w-full mt-4">
                <div className="flex justify-between text-xs text-gray-400 mb-1 font-mono uppercase">
                    <span>{label}</span>
                    <span>{progress}%</span>
                </div>
                <div className="w-full bg-gray-800 h-2 rounded-full overflow-hidden">
                    <div className={`h-full transition-all duration-500 ${colorClass}`} style={{width: `${progress}%`}}></div>
                </div>
            </div>
        );

        // 统一操作按钮组件
        const ActionButton = ({ isPaused, onToggle, pauseText, resumeText, colorTheme }) => {
            const btnColorClass = isPaused 
                ? 'bg-yellow-600 text-white animate-pulse border-none' 
                : 'bg-gray-800 text-gray-200 border border-gray-700 hover:bg-gray-700';

            return (
                <button 
                    onClick={onToggle}
                    className={`w-full h-16 rounded-xl text-lg font-bold shadow-lg flex items-center justify-center gap-3 transition-all ${btnColorClass}`}
                >
                    {isPaused ? <><i className="fas fa-play"></i> {resumeText}</> : <><i className="fas fa-pause"></i> {pauseText}</>}
                </button>
            );
        };
        
        // 结束任务按钮 - 图标已修改为方形停止图标 (fa-stop)
        const EndTaskButton = ({ onClick }) => (
            <button 
                onClick={onClick}
                className="h-16 w-20 rounded-xl bg-red-900/30 border border-red-800 text-red-400 font-bold flex flex-col items-center justify-center gap-1 hover:bg-red-900/60 transition-all text-xs"
            >
                <i className="fas fa-stop text-xl"></i>
                结束
            </button>
        );

        // 页面布局组件
        const PageLayout = ({ colorTheme, taskId, taskStatus, currentAction, subContent, actionArea, visualArea, progress, progressLabel, customProgress, progressBarColor }) => {
            const themeColors = {
                yellow: 'text-yellow-500 border-yellow-500 bg-yellow-500',
                green: 'text-green-500 border-green-500 bg-green-500',
                red: 'text-red-500 border-red-500 bg-red-500',
                purple: 'text-purple-400 border-purple-400 bg-purple-500',
                blue: 'text-blue-400 border-blue-400 bg-blue-500',
            };
            const theme = themeColors[colorTheme] || themeColors.blue;
            const textColor = theme.split(' ')[0];
            const borderColor = theme.split(' ')[1];
            const bgColor = theme.split(' ')[2];
            
            const finalProgressColor = progressBarColor || bgColor;

            return (
                <div className="flex flex-col h-full bg-black relative">
                    <div className={`h-1/2 bg-gray-900 p-8 flex flex-col relative z-20 border-b-2 ${borderColor} border-opacity-50`}>
                        <div className="text-xs font-mono mb-2 uppercase tracking-widest flex items-center gap-2">
                            <span className={`w-2 h-2 rounded-full ${bgColor} animate-pulse`}></span>
                            <span className={`${textColor} font-bold text-sm`}>{taskStatus}</span>
                            <span className="text-gray-600">|</span>
                            <span className="text-gray-500">NO. {taskId}</span>
                        </div>
                        
                        <div className="flex-grow flex flex-col justify-center w-full overflow-hidden">
                            <h1 className="text-3xl font-bold text-white mb-2 leading-tight truncate" title={currentAction}>
                                {currentAction}
                            </h1>
                            <div className="text-gray-400 text-base truncate" title={subContent}>
                                {subContent}
                            </div>
                        </div>

                        {customProgress ? (
                            customProgress
                        ) : (
                            progress !== undefined && (
                                <ProgressBar progress={progress} colorClass={finalProgressColor} label={progressLabel || "任务进度"} />
                            )
                        )}
                        
                        {actionArea && (
                            <div className="mt-6 flex gap-3">
                                {actionArea}
                            </div>
                        )}
                    </div>

                    <div className="h-1/2 bg-gray-950 relative overflow-hidden flex flex-col">
                        {visualArea}
                    </div>
                </div>
            );
        };

        // --- 业务场景组件 ---

        // 场景 1: 领航模式
        const NavigationMode = ({ onEndTask }) => {
            const [isPaused, setIsPaused] = useState(false);
            const [distance, setDistance] = useState(12);
            const [isArrived, setIsArrived] = useState(false);
            
            useEffect(() => {
                if(isPaused || isArrived) return;
                const timer = setInterval(() => {
                    setDistance(d => {
                        const newVal = d - 0.1;
                        if (newVal <= 0) {
                            setIsArrived(true);
                            return 0;
                        }
                        return newVal.toFixed(1);
                    });
                }, 50);
                return () => clearInterval(timer);
            }, [isPaused, isArrived]);

            const totalDist = 50;
            const progress = Math.min(100, Math.max(0, ((totalDist - distance) / totalDist) * 100)).toFixed(0);

            return (
                <PageLayout
                    colorTheme={isArrived ? "green" : "yellow"}
                    taskStatus="领航中"
                    taskId="NAV-092-A"
                    currentAction={
                        isArrived ? "已到达目标库位" : 
                        isPaused ? "已暂停等待" : "正在前往 A-03-2"
                    }
                    subContent={
                        isArrived ? 
                        "请核对：A-03-2 | 高压阀门组件 x 2" : 
                        "待拣选：高压阀门组件 x 2"
                    }
                    progress={isArrived ? 100 : progress}
                    progressLabel={isArrived ? "导航结束" : "行驶进度"}
                    actionArea={
                        isArrived ? (
                            <>
                                <button 
                                    onClick={() => { setIsArrived(false); setDistance(12); }}
                                    className="flex-1 h-16 rounded-xl text-lg font-bold shadow-lg flex items-center justify-center gap-3 transition-all bg-green-600 text-white hover:bg-green-500 animate-pulse"
                                >
                                    <i className="fas fa-check-circle"></i> 确认到达
                                </button>
                                <EndTaskButton onClick={onEndTask} />
                            </>
                        ) : (
                            <>
                                <div className="flex-1">
                                    <ActionButton 
                                        isPaused={isPaused} 
                                        onToggle={() => setIsPaused(!isPaused)} 
                                        pauseText="暂停领航" 
                                        resumeText="继续领航"
                                    />
                                </div>
                                <EndTaskButton onClick={onEndTask} />
                            </>
                        )
                    }
                    visualArea={
                        <>
                            <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')]"></div>
                            <div className="flex-1 flex flex-col items-center justify-center relative">
                                {isArrived ? (
                                    <div className="flex flex-col items-center">
                                        <div className="w-40 h-40 bg-green-500/20 rounded-full flex items-center justify-center mb-6 relative">
                                            <div className="absolute inset-0 border-4 border-green-500/50 rounded-full animate-ping"></div>
                                            <div className="w-32 h-32 bg-green-500 rounded-full flex items-center justify-center shadow-[0_0_30px_rgba(34,197,94,0.8)] z-10">
                                                <i className="fas fa-map-marker-alt text-6xl text-white"></i>
                                            </div>
                                        </div>
                                        <div className="text-green-500 text-3xl font-bold font-tech tracking-widest">已到达</div>
                                        <div className="text-gray-400 text-sm mt-2 font-mono">当前位置: A-03-2</div>
                                    </div>
                                ) : isPaused ? (
                                    <div className="text-yellow-500 text-xl font-bold blink">等待指令...</div>
                                ) : (
                                    <>
                                        <div className="absolute top-6 left-6 text-gray-500 font-mono text-xs">剩余距离</div>
                                        <div className="text-7xl font-tech text-yellow-500">{Math.ceil(distance)}<span className="text-3xl text-gray-400">m</span></div>
                                        <div className="mt-4 animate-bounce text-yellow-500 text-3xl"><i className="fas fa-arrow-up"></i></div>
                                        <div className="absolute bottom-4 text-center w-full text-gray-600 text-xs">下一节点：3号巷道口</div>
                                    </>
                                )}
                            </div>
                        </>
                    }
                />
            );
        };

        // 场景 2: 盘点模式
        const InventoryMode = ({ onEndTask }) => {
            const [count, setCount] = useState(1245);
            const [progress, setProgress] = useState(45);
            const [isPaused, setIsPaused] = useState(false);

            useEffect(() => {
                if (isPaused) return;
                const timer = setInterval(() => {
                    setCount(c => c + Math.floor(Math.random() * 3));
                    setProgress(p => p < 100 ? p + 0.1 : 0);
                }, 200);
                return () => clearInterval(timer);
            }, [isPaused]);

            return (
                <PageLayout
                    colorTheme="green"
                    taskStatus="盘点中"
                    taskId="INV-2024-Q4"
                    currentAction={isPaused ? "盘点任务已暂停" : "正在扫描 A 区货架"}
                    subContent={`已读取标签：${count}`}
                    progress={progress.toFixed(0)}
                    progressLabel="区域覆盖率"
                    actionArea={
                        <>
                            <div className="flex-1">
                                {/* 统一使用 ActionButton 组件 */}
                                <ActionButton 
                                    isPaused={isPaused} 
                                    onToggle={() => setIsPaused(!isPaused)} 
                                    pauseText="暂停/中断" 
                                    resumeText="恢复扫描"
                                />
                            </div>
                            <EndTaskButton onClick={onEndTask} />
                        </>
                    }
                    visualArea={
                        <div className="flex-1 p-6 font-mono relative">
                            {!isPaused && <div className="scan-line"></div>}
                            <div className="space-y-3 mt-4">
                                <div className="flex justify-between text-xs text-gray-400 border-b border-gray-800 pb-2">
                                    <span>TAG: 8933-AF21-001</span><span className="text-green-500">正常</span>
                                </div>
                                <div className="flex justify-between text-xs text-gray-400 border-b border-gray-800 pb-2">
                                    <span>TAG: 7721-BC99-042</span><span className="text-green-500">正常</span>
                                </div>
                                <div className="flex justify-between text-xs text-gray-400 border-b border-gray-800 pb-2">
                                    <span>TAG: 1102-DD01-X99</span><span className="text-yellow-500">数量不符</span>
                                </div>
                                <div className="flex justify-between text-xs text-gray-400 border-b border-gray-800 pb-2 opacity-50">
                                    <span>TAG: 4421-AA22-112</span><span className="text-gray-500">{isPaused ? "等待中" : "读取中..."}</span>
                                </div>
                            </div>
                        </div>
                    }
                />
            );
        };

        // 场景 3: 巡查模式
        const PatrolMode = ({ onEndTask }) => {
            const [hasObstacle, setHasObstacle] = useState(false);
            const [progress, setProgress] = useState(72);
            const [isPaused, setIsPaused] = useState(false);

            useEffect(() => {
                if (isPaused) return; 
                
                const interval = setInterval(() => setHasObstacle(prev => !prev), 5000);
                const progressTimer = setInterval(() => setProgress(p => p < 100 ? p + 0.2 : 0), 500);
                
                return () => {
                    clearInterval(interval);
                    clearInterval(progressTimer);
                };
            }, [isPaused]);

            return (
                <PageLayout
                    colorTheme={hasObstacle ? "red" : "blue"}
                    taskStatus={hasObstacle ? "巡查中(异常)" : "巡查中"}
                    progressBarColor="bg-blue-500" 
                    taskId="SEC-001-B4"
                    currentAction={
                        isPaused ? "巡查任务已暂停" : 
                        hasObstacle ? "发现障碍物" : "正在巡视 B-04 巷道"
                    }
                    subContent={
                        isPaused ? "等待人工确认..." :
                        hasObstacle ? "已自动停止，正在上报异常..." : "路面状态良好，无异常"
                    }
                    progress={hasObstacle ? 72 : progress.toFixed(0)} 
                    progressLabel="本轮巡查进度"
                    actionArea={
                        <>
                            <div className="flex-1">
                                <ActionButton 
                                    isPaused={isPaused} 
                                    onToggle={() => setIsPaused(!isPaused)} 
                                    pauseText="暂停巡查" 
                                    resumeText="继续巡查"
                                />
                            </div>
                            <EndTaskButton onClick={onEndTask} />
                        </>
                    }
                    visualArea={
                        <div className="flex-1 relative flex items-center justify-center bg-black overflow-hidden">
                            {/* 恢复模拟背景 */}
                            <div className="absolute inset-0 opacity-40 bg-[url('https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80')] bg-cover bg-center grayscale mix-blend-overlay"></div>

                            <div className="absolute inset-0 pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')] opacity-10"></div>

                            <div className="w-48 h-48 border border-gray-700 rounded-full relative flex items-center justify-center z-10">
                                <div className={`w-full h-1 absolute top-1/2 left-0 origin-center shadow-[0_0_20px_rgba(255,255,255,0.2)] ${isPaused ? '' : 'animate-[spin_3s_linear_infinite]'} ${hasObstacle ? 'bg-red-500/50' : 'bg-blue-500/50'}`}></div>
                                <div className={`w-2 h-2 rounded-full absolute ${hasObstacle ? 'bg-red-500' : 'bg-blue-500'}`}></div>
                                {hasObstacle && !isPaused && <div className="absolute top-8 right-12 w-4 h-4 bg-red-600 rounded-full animate-ping"></div>}
                            </div>
                             
                             {hasObstacle && !isPaused && <div className="absolute inset-0 border-4 border-red-500 opacity-50 blink pointer-events-none z-20"></div>}
                             
                             <div className="absolute bottom-4 left-6 text-xs font-mono text-gray-500 z-20 bg-black/50 px-2 py-1 rounded backdrop-blur-sm">
                                 影像: <span className="text-yellow-500">模拟</span> <br/>
                                 雷达: {isPaused ? '待机' : '运行中'}
                             </div>
                        </div>
                    }
                />
            );
        };

        // 场景 4: 复查模式
        const AuditMode = ({ onEndTask }) => {
            const [step, setStep] = useState(0);
            const [isPaused, setIsPaused] = useState(false);
            
            useEffect(() => {
                if(isPaused) return;
                const timer = setInterval(() => setStep(prev => (prev + 1) % 4), 3500); 
                return () => clearInterval(timer);
            }, [isPaused]);

            const steps = [
                { title: "前往", status: "Done" },
                { title: "对准", status: "Active" },
                { title: "拍照", status: "Pending" },
                { title: "上传", status: "Pending" }
            ];
            
            const currentActionText = [
                "正在前往目标库位...", 
                "正在自动对准货位...", 
                "正在拍照记录...", 
                "数据上传中..."
            ][step];

            const renderVisualArea = () => {
                if (isPaused) {
                    return (
                         <div className="w-full h-full bg-gray-900 flex items-center justify-center relative overflow-hidden">
                            <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-30"></div>
                            <div className="z-10 text-center">
                                <i className="fas fa-pause text-5xl text-gray-600 mb-4"></i>
                                <div className="text-gray-500">任务挂起</div>
                            </div>
                         </div>
                    );
                }

                switch (step) {
                    case 0: // 前往
                        return (
                            <div className="w-full h-full bg-gray-950 flex items-center justify-center relative overflow-hidden">
                                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')] opacity-10"></div>
                                <div className="text-center">
                                    <div className="text-7xl text-purple-500 animate-bounce mb-4"><i className="fas fa-arrow-up"></i></div>
                                    <div className="text-gray-400 font-mono text-xs">正在前往目标点</div>
                                </div>
                            </div>
                        );
                    case 1: // 对准
                        return (
                            <div className="w-full h-full bg-black relative">
                                <img src="https://images.unsplash.com/photo-1553413077-190dd305871c?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" className="w-full h-full object-cover opacity-60" />
                                <div className="absolute inset-0 flex items-center justify-center">
                                    <div className="w-3/4 h-3/4 border-2 border-yellow-500/50 relative">
                                        <div className="absolute -top-1 -left-1 w-4 h-4 border-t-4 border-l-4 border-yellow-500"></div>
                                        <div className="absolute -top-1 -right-1 w-4 h-4 border-t-4 border-r-4 border-yellow-500"></div>
                                        <div className="absolute -bottom-1 -left-1 w-4 h-4 border-b-4 border-l-4 border-yellow-500"></div>
                                        <div className="absolute -bottom-1 -right-1 w-4 h-4 border-b-4 border-r-4 border-yellow-500"></div>
                                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-yellow-500/80 text-4xl">+</div>
                                    </div>
                                </div>
                                <div className="absolute bottom-4 left-0 w-full text-center text-yellow-500 text-xs font-mono blink">正在自动对准...</div>
                            </div>
                        );
                    case 2: // 拍照
                        return (
                            <div className="w-full h-full bg-black relative">
                                <img src="https://images.unsplash.com/photo-1553413077-190dd305871c?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" className="w-full h-full object-cover" />
                                <div className="absolute inset-0 bg-white/20 animate-pulse"></div>
                                <div className="absolute inset-0 border-4 border-green-500 m-4"></div>
                                <div className="absolute bottom-6 right-6 bg-red-600 px-3 py-1 rounded text-xs font-bold shadow-lg animate-pulse">REC ● 录像中</div>
                            </div>
                        );
                    case 3: // 上传
                        return (
                            <div className="w-full h-full bg-gray-900 flex items-center justify-center relative overflow-hidden">
                                <div className="absolute inset-0 bg-green-900/10"></div>
                                <div className="flex flex-col items-center z-10">
                                    <div className="w-20 h-20 rounded-full border-4 border-green-500/30 flex items-center justify-center mb-4 relative">
                                         <i className="fas fa-cloud-upload-alt text-4xl text-green-500"></i>
                                         <div className="absolute inset-0 border-t-4 border-green-500 rounded-full animate-spin"></div>
                                    </div>
                                    <div className="text-green-500 font-mono text-lg upload-dots">
                                        数据上传中<span>.</span><span>.</span><span>.</span>
                                    </div>
                                </div>
                            </div>
                        );
                    default: return null;
                }
            };

            return (
                <PageLayout
                    colorTheme="purple"
                    taskStatus="复查中"
                    taskId="CHK-8821"
                    currentAction={isPaused ? "复查已暂停" : currentActionText}
                    subContent={`目标：A-02-1 上层`}
                    customProgress={
                        <div className="w-full mt-6">
                            <div className="flex justify-between text-xs text-gray-400 mb-2 font-mono uppercase">
                                <span>当前流程: {steps[step].title}</span>
                                <span>步骤 {step + 1}/4</span>
                            </div>
                            
                            <div className="flex gap-2 h-2">
                                {[0, 1, 2, 3].map(i => (
                                    <div key={i} className={`flex-1 rounded-full transition-all duration-500 ${
                                        i <= step ? 'bg-purple-500' : 'bg-gray-800'
                                    } ${i === step && !isPaused ? 'animate-pulse' : ''}`}></div>
                                ))}
                            </div>
                        </div>
                    }
                    actionArea={
                         <>
                            <div className="flex-1">
                                <ActionButton 
                                    isPaused={isPaused} 
                                    onToggle={() => setIsPaused(!isPaused)} 
                                    pauseText="暂停任务" 
                                    resumeText="继续任务"
                                />
                            </div>
                            <EndTaskButton onClick={onEndTask} />
                         </>
                    }
                    visualArea={renderVisualArea()}
                />
            );
        };

        // 新增：语音交互模式
        const VoiceMode = ({ onClose }) => {
            const [phase, setPhase] = useState('listening'); // listening, processing, speaking
            const [transcript, setTranscript] = useState('');
            const [reply, setReply] = useState('');

            // 模拟对话流程
            useEffect(() => {
                let timers = [];
                
                // 1. 聆听阶段 (0s - 2.5s)
                timers.push(setTimeout(() => {
                    setTranscript("请帮我查找 A-03 货架的库存状态");
                }, 1500));

                // 2. 思考阶段 (2.5s - 4s)
                timers.push(setTimeout(() => {
                    setPhase('processing');
                }, 2500));

                // 3. 回复阶段 (4s - 10s)
                timers.push(setTimeout(() => {
                    setPhase('speaking');
                    setReply("收到。A-03 货架当前存放高压阀门组件 5 件，状态正常。");
                }, 4000));

                return () => timers.forEach(clearTimeout);
            }, []);

            return (
                <div className="flex flex-col h-full bg-black relative overflow-hidden">
                    {/* 背景动效 */}
                    <div className="absolute inset-0 opacity-30 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-blue-900 via-gray-900 to-black"></div>
                    
                    {/* 关闭按钮 */}
                    <button onClick={onClose} className="absolute top-6 right-6 text-gray-500 hover:text-white z-50">
                        <i className="fas fa-times text-2xl"></i>
                    </button>

                    <div className="flex-1 flex flex-col items-center justify-center relative z-10 p-8 text-center">
                        
                        {/* 核心视觉元素 */}
                        <div className="mb-12">
                            {phase === 'listening' && (
                                <div className="orb"></div>
                            )}
                            {phase === 'processing' && (
                                <div className="w-20 h-20 flex items-center justify-center">
                                    <i className="fas fa-circle-notch text-5xl text-blue-400 animate-spin"></i>
                                </div>
                            )}
                            {phase === 'speaking' && (
                                <div className="flex items-center gap-1 h-16">
                                    {[...Array(5)].map((_, i) => (
                                        <div key={i} className="w-3 bg-blue-400 rounded-full animate-[sound_0.5s_ease-in-out_infinite_alternate]" style={{height: '20px', animationDelay: `${i * 0.1}s`}}></div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* 状态文字 */}
                        <div className="min-h-[120px] w-full max-w-xs">
                            <div className="text-blue-400 text-sm font-bold uppercase tracking-widest mb-4">
                                {phase === 'listening' ? '正在聆听...' : phase === 'processing' ? '思考中...' : '回复中'}
                            </div>
                            
                            {/* 对话内容展示 */}
                            <div className="space-y-4 text-left">
                                {transcript && (
                                    <div className="bg-gray-800/50 p-4 rounded-xl rounded-tl-none border-l-2 border-gray-500 animate-[fadeIn_0.5s_ease-out]">
                                        <div className="text-[10px] text-gray-400 mb-1">我</div>
                                        <div className="text-white text-lg font-bold">{transcript}</div>
                                    </div>
                                )}
                                
                                {reply && (
                                    <div className="bg-blue-900/30 p-4 rounded-xl rounded-tr-none border-r-2 border-blue-500 animate-[fadeIn_0.5s_ease-out]">
                                        <div className="text-[10px] text-blue-300 mb-1">机器人</div>
                                        <div className="text-white text-lg leading-relaxed">{reply}</div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 场景 5: 空闲待机
        const IdleMode = () => (
            <div className="flex flex-col h-full bg-slate-900 breathing-bg relative">
                <div className="h-1/2 p-8 flex flex-col justify-end items-center z-20">
                    <div className="flex justify-center gap-10 mb-10 opacity-80">
                        <div className="w-16 h-3 bg-blue-400 rounded-full shadow-[0_0_15px_rgba(96,165,250,0.8)]"></div>
                        <div className="w-16 h-3 bg-blue-400 rounded-full shadow-[0_0_15px_rgba(96,165,250,0.8)]"></div>
                    </div>
                    <div className="text-center">
                        <h1 className="text-3xl font-tech text-white mb-2">ROBOT-01</h1>
                        <p className="text-blue-400 font-mono text-sm mb-6">仓储助手机器人</p>
                        <div className="flex flex-col items-center gap-2">
                            <div className="voice-wave">
                                {[...Array(5)].map((_,i) => <div key={i} className="voice-bar" style={{animationDelay: `${i*0.1}s`}}></div>)}
                            </div>
                            <p className="text-blue-200 text-sm animate-pulse opacity-70">语音唤醒待机中...</p>
                        </div>
                    </div>
                </div>
                
                <div className="h-1/2 p-6 border-t border-gray-800/50 bg-black/40 text-gray-400 flex flex-col">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-xs font-bold uppercase tracking-widest text-blue-400">今日任务统计</h3>
                        <span className="text-[10px] font-mono bg-gray-800 px-2 py-1 rounded text-gray-500">2024-05-20</span>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-3 flex-1">
                        <div className="bg-gray-800/40 p-3 rounded-lg border-l-2 border-yellow-500 flex flex-col justify-between hover:bg-gray-800/60 transition-colors">
                            <div className="flex justify-between items-start">
                                <div className="text-[10px] uppercase text-yellow-500/80"><i className="fas fa-location-arrow mr-1"></i> 领航</div>
                                <div className="text-[10px] text-gray-600">NAV</div>
                            </div>
                            <div>
                                <div className="flex items-baseline gap-1">
                                    <span className="text-2xl font-bold text-white font-tech">12</span>
                                    <span className="text-xs">次</span>
                                </div>
                                <div className="text-[10px] opacity-60">累计里程 4.2km</div>
                            </div>
                        </div>

                        <div className="bg-gray-800/40 p-3 rounded-lg border-l-2 border-green-500 flex flex-col justify-between hover:bg-gray-800/60 transition-colors">
                            <div className="flex justify-between items-start">
                                <div className="text-[10px] uppercase text-green-500/80"><i className="fas fa-barcode mr-1"></i> 盘点</div>
                                <div className="text-[10px] text-gray-600">INV</div>
                            </div>
                            <div>
                                <div className="flex items-baseline gap-1">
                                    <span className="text-2xl font-bold text-white font-tech">1.5w</span>
                                    <span className="text-xs">件</span>
                                </div>
                                <div className="text-[10px] opacity-60">覆盖率 98%</div>
                            </div>
                        </div>

                        <div className="bg-gray-800/40 p-3 rounded-lg border-l-2 border-blue-500 flex flex-col justify-between hover:bg-gray-800/60 transition-colors">
                             <div className="flex justify-between items-start">
                                <div className="text-[10px] uppercase text-blue-500/80"><i className="fas fa-shield-alt mr-1"></i> 巡查</div>
                                <div className="text-[10px] text-gray-600">SEC</div>
                             </div>
                             <div>
                                <div className="flex items-baseline gap-1">
                                    <span className="text-2xl font-bold text-white font-tech">6.5</span>
                                    <span className="text-xs">h</span>
                                </div>
                                <div className="text-[10px] opacity-60">发现异常 2 处</div>
                            </div>
                        </div>

                        <div className="bg-gray-800/40 p-3 rounded-lg border-l-2 border-purple-500 flex flex-col justify-between hover:bg-gray-800/60 transition-colors">
                             <div className="flex justify-between items-start">
                                <div className="text-[10px] uppercase text-purple-500/80"><i className="fas fa-camera mr-1"></i> 复查</div>
                                <div className="text-[10px] text-gray-600">CHK</div>
                             </div>
                             <div>
                                <div className="flex items-baseline gap-1">
                                    <span className="text-2xl font-bold text-white font-tech">8</span>
                                    <span className="text-xs">单</span>
                                </div>
                                <div className="text-[10px] opacity-60">上传成功 100%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="mt-3 flex justify-between text-[10px] font-mono opacity-40 pt-2 border-t border-gray-800">
                        <span><i className="fas fa-thermometer-half mr-1"></i>24.5°C</span>
                        <span><i className="fas fa-tint mr-1"></i>42%</span>
                    </div>
                </div>
            </div>
        );

        // --- 主应用 ---
        const App = () => {
            const [mode, setMode] = useState('idle');

            const handleEndTask = () => {
                setMode('idle');
            };

            const renderScreen = () => {
                switch(mode) {
                    case 'nav': return <NavigationMode onEndTask={handleEndTask} />;
                    case 'inventory': return <InventoryMode onEndTask={handleEndTask} />;
                    case 'patrol': return <PatrolMode onEndTask={handleEndTask} />;
                    case 'audit': return <AuditMode onEndTask={handleEndTask} />;
                    case 'voice': return <VoiceMode onClose={() => setMode('idle')} />;
                    case 'idle': return <IdleMode />;
                    default: return <IdleMode />;
                }
            };

            return (
                <div className="w-full h-full flex flex-col bg-black relative">
                    <div className="flex-1 overflow-hidden relative">
                        {renderScreen()}
                    </div>

                    <div className="fixed bottom-0 left-0 w-full bg-slate-800/90 backdrop-blur-md p-4 border-t border-slate-700 flex justify-center gap-4 shadow-2xl z-[100]">
                        {[
                            { id: 'idle', label: '空闲', color: 'text-blue-400' },
                            { id: 'nav', label: '领航', color: 'text-yellow-400' },
                            { id: 'inventory', label: '盘点', color: 'text-green-400' },
                            { id: 'patrol', label: '巡查', color: 'text-red-400' },
                            { id: 'audit', label: '复查', color: 'text-purple-400' },
                            { id: 'voice', label: '语音演示', color: 'text-cyan-400' },
                        ].map(btn => (
                            <button 
                                key={btn.id}
                                onClick={() => setMode(btn.id)} 
                                className={`px-3 py-2 rounded-lg text-xs font-bold transition-all bg-slate-700 hover:bg-slate-600 flex items-center ${mode === btn.id ? `bg-slate-900 ring-2 ring-offset-1 ring-offset-slate-800 ${btn.color}` : 'text-gray-400'}`}
                            >
                                <i className={`fas fa-circle text-[6px] mr-1 ${mode === btn.id ? '' : 'opacity-0'}`}></i>
                                {btn.label}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
